<!DOCTYPE html>
<html>
  <head>
    <script type="application/javascript">
      const height = 300
      const width = 300

      function createParticles(n) {
        const particles = []

        for (var i = 0; i < n; i++) {
          particles.push(
            {
              position: { x: Math.random() * width, y: Math.random() * height },
              velocity: { x: 0, y: 0 }
            }
          );
        }

        return particles;
      };

      function sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
      }

      async function start() {
        const particles = createParticles(50);

        for (var i = 0; i < 1000; i++) {
          draw(particles);
          updatePositions(particles);
          updateVelocities(particles);
          await sleep(50)
        }
      }

      function draw(particles) {
        const canvas = document.getElementById("canvas");

        if (canvas.getContext) {
          const ctx = canvas.getContext("2d");
          ctx.fillStyle = "rgb(200, 0, 0)";
          const startAngle = 0
          const endAngle = Math.PI * 2

          ctx.clearRect(0, 0, width, height);

          particles.forEach((p) => {
            ctx.beginPath();
            ctx.arc(p.position.x, p.position.y, 4, startAngle, endAngle);
            ctx.fill();
          })
        }
      };

      function addVector(v, w) {
        return { x: v.x + w.x, y: v.y + w.y }
      }

      function updatePositions(particles) {
        particles.forEach((p) => {
          p.position = addVector(p.position, p.velocity)
        })
      };

      function updateVelocities(particles) {
        particles.forEach((p) => {
          p.velocity = addVector(p.velocity, { x: Math.random() - 0.5, y: Math.random() - 0.5 })
        })
      };
    </script>
  </head>
  <body>
    <h1>Charge</h1>
    <canvas id="canvas" height="300px" width="300px"></canvas>
    <script type="application/javascript">
      start();
    </script>
  </body>
</html>
